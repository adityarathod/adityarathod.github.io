<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta property="og:title" content="Protecting Trivia Apps from Cheaters"/><meta property="og:description" content="How people cheat at trivia games, and how the companies running them could stop this from happening."/><meta property="og:type" content="article"/><meta name="description" content="How people cheat at trivia games, and how the companies running them could stop this from happening."/><title>Protecting Trivia Apps from Cheaters</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/a32ffd38482d2ae5657c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a32ffd38482d2ae5657c.css"/><link rel="preload" href="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/blog/protect-trivia-from-bots.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ca3e7fa29692f350ed1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/99c2e695fd90543c92b695dce12c7a1926685b00.803f13d53fcc71fd0a07.js" as="script"/><link rel="preload" href="/_next/static/chunks/2ace1ae04e7892d3f9075ba0904f191743ac923b.ec503d89e80e050bcc1d.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-ef776554a889c25f7403.js" as="script"/></head><body><div id="__next"><div class="my-8 mx-auto w-full"><button class="absolute text-sm font-bold outline-none text-systemBlue-dark" style="top:10px;right:10px;outline:none">dark<!-- --> mode</button><div class="mb-8"><h1 class="text-3xl text-center font-bold text-label-dark">Aditya Rathod</h1><div class="px-4 max-w-lg mx-auto my-0 flex flex-row items-center justify-between"><a href="/" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">home</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="//github.com/adityarathod" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">github</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="//linkedin.com/in/aditya-rathod" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">linkedin</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="/resume.pdf" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">resumé</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="/blog" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">blog</a></div></div></div><main class="mx-auto my-0 mt-4 max-w-5xl px-8 py-6" style="border-radius:15px"><h1 class="text-label-dark text-4xl font-bold mx-auto my-0 max-w-xl mb-6 text-center">Protecting Trivia Apps from Cheaters</h1><div class="mb-6 text-center text-secondaryLabel-dark">December 16, 2017</div><p class="my-4 leading-relaxed text-label-dark"><em>This article has been mentioned in the media: <a href="https://www.theverge.com/2017/12/25/16817502/how-to-stop-hq-cheaters" class="text-link-dark">The Verge</a>, <a href="https://www.washingtonpost.com/graphics/2018/business/hq-trivia/" class="text-link-dark">Washington Post</a>, and <a href="https://techcrunch.com/2018/03/06/hq-trivia-questions/" class="text-link-dark">TechCrunch</a></em>.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Introduction</h1><p class="my-4 leading-relaxed text-label-dark"><em>Mobile trivia apps</em>, such as HQ Trivia and The Q, modernize game show-style entertainment, allowing anyone to try their hand at winning cash prizes from their smartphone from anywhere. However, these applications are susceptible to cheaters and bots. For example, <a href="https://medium.com/@tobymellor/hq-trivia-using-bots-to-win-money-from-online-game-shows-ce2a1b11828b" class="text-link-dark">a developer by the name of Toby Mellor</a> recently demonstrated how he created a near-realtime system to cheat on HQ Trivia. His post (linked above) details his use of Google cloud APIs to create this system.</p><p class="my-4 leading-relaxed text-label-dark">While the demo was certainly impressive, I felt that I could improve on this system as a proof-of-concept. Armed with his post, I set out to make a better version of his system. However, I set some constraints on myself to make this more of a challenge:</p><ul class="list-disc mx-6 my-2 text-label-dark"><li>The system must run offline, with the exception of the QAS (question-and-answer system).</li><li>The system allow a human enough time to tap in the answer.</li><li>The system should require minimal human intervention, since a human will be using the system in real time.</li><li>The system must be functional within one hour.</li></ul><p class="my-4 leading-relaxed text-label-dark">I was now ready to get started.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Creating a Trivia-Cheating System</h1><h2 class="text-xl font-medium my-2 text-label-dark">Design</h2><p class="my-4 leading-relaxed text-label-dark">Instead of doing fancy (and slow) network-request hijacking using <code>mitmproxy</code>, I decided to run OCR at intervals on a portion of the image coming from the phone and pipe that to Google to provide a quick answer for the human operator to tap in. The system looks something like the following:</p><p class="my-4 leading-relaxed text-label-dark"><img src="/static/img/trivia-diagram.svg" alt="System diagram" class="mx-auto my-4 text-center"/></p><p class="my-4 leading-relaxed text-label-dark">TL;DR: a region of the iPhone&#x27;s screen will get captured, put through OCR, and then searched up on Google to get an answer.</p><h2 class="text-xl font-medium my-2 text-label-dark">Implementation</h2><h3 class="text-lg text-label-dark">Capturing the Screen</h3><p class="my-4 leading-relaxed text-label-dark">First, I needed a way to capture only a region of the QuickTime window on my Mac into a temp file. That turned out to be trivial using the excellent CLI <code>screencapture</code> tool.</p><p class="my-4 leading-relaxed text-label-dark">I initially used interactive selection, where the user manually makes a rectangular selection to capture:</p><pre class="language-bash"><code class="language-bash">screencapture -ci screens.png
</code></pre><p class="my-4 leading-relaxed text-label-dark">However, I quickly realized that was extremely inefficient and that hardcoding in rect coordinates (a feature <code>screencapture</code> supports) was a much better option:</p><pre class="language-bash"><code class="language-bash"> screencapture -Rx,y,w,h screens.png
</code></pre><p class="my-4 leading-relaxed text-label-dark"><em>Note:</em> The rect coordinates are in the form <code>x,y,w,h</code>, with <code>(x, y)</code> being the coordinate of the top left corner.</p><h3 class="text-lg text-label-dark">Optical Character Recognition</h3><p class="my-4 leading-relaxed text-label-dark">It was time to find a passable OCR system that was fast and accurate. The only one I could think of was <a href="https://github.com/tesseract-ocr/tesseract" class="text-link-dark"><code>tesseract</code></a>, an OCR engine maintained by Google. While not the best system in the world, its functionality out of the box was pretty great in my testing.</p><p class="my-4 leading-relaxed text-label-dark">In order to extract text from our image using Tesseract, I used the following,</p><pre class="language-bash"><code class="language-bash">tesseract screens.png ocr
</code></pre><p class="my-4 leading-relaxed text-label-dark">which takes the image and puts the extracted text into a file, <code>ocr.txt</code>. Now, it&#x27;s finally time to answer this question.</p><h3 class="text-lg text-label-dark">Constructing a Google Search URL and Launching Chrome</h3><p class="my-4 leading-relaxed text-label-dark">One little nasty step we have to do is to put our URL-encoded search query into a Google Search URL and then push that URL to a browser of choice (I used Google Chrome). I used Python for this step because of its familiarity.</p><h3 class="text-lg text-label-dark">URL Encoding the Search Query</h3><p class="my-4 leading-relaxed text-label-dark">A typical Google search URL looks something like this:</p><blockquote class="mx-3 px-4 py-1 border-l-4 italic leading-tight text-secondaryLabel-dark border-systemGray-dark"><p class="my-4 leading-relaxed text-label-dark"><em><a href="https://www.google.com/search&amp;q=what+is+life%3F" class="text-link-dark">https://www.google.com/search&amp;q=what+is+life%3F</a></em></p></blockquote><p class="my-4 leading-relaxed text-label-dark">Notice how the search query is a query string, the spaces are replaced with <code>+</code> signs, and special characters are encoded. Python 3 can do this easily with <code>urllib.parse.quote_plus(str)</code>.</p><p class="my-4 leading-relaxed text-label-dark">So our code might look something like this:</p><pre class="language-python"><code class="language-python">query_encoded <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote_plus<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</code></pre><h3 class="text-lg text-label-dark">Programmatically Launching Chrome</h3><p class="my-4 leading-relaxed text-label-dark">Now, we need to pass the URL to Chrome programmatically. With a little bit of trial and error, I found out that the Unix binary, located at <code>/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome</code>, can open URLs without launching a new browser instance. Using that to our advantage, we simply pass the URL as a shell argument, and <em>violà!</em> It works.</p><h3 class="text-lg text-label-dark">Stitching These Components Together</h3><p class="my-4 leading-relaxed text-label-dark">Now, it&#x27;s time to mesh these components together. I decided to keep it simple and created a shell script to run each component and pass around data. My shell script ended up looking like this:</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/local/bin/zsh</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Realtime Screen OCR&quot;</span>
<span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Waiting for trigger&quot;</span>
    <span class="token builtin class-name">read</span>
    screencapture -Rx,y,w,h screens.png
    tesseract screens.png ocr
    <span class="token assign-left variable">OCR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> ocr.txt<span class="token variable">`</span></span>
    python3 launch.py <span class="token variable">$OCR</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Opened Chrome...waiting for next question&quot;</span>
<span class="token keyword">done</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">The script waits for the enter key, grabs the predefined rect, runs OCR on it, and then launches Chrome. Then, it goes back to waiting for the enter key.</p><h2 class="text-xl font-medium my-2 text-label-dark">Testing and Debrief</h2><p class="my-4 leading-relaxed text-label-dark">I ran tests on this system using video replays of previous HQ Trivia shows. It worked well but struggled on the more difficult questions. Here&#x27;s a video of the system providing an instant answer to a question:</p><center><iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/F1m6ZyqIvhs?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe></center><p class="my-4 leading-relaxed text-label-dark">In my opinion, this checks all the boxes–it works offline, it&#x27;s fast, and it&#x27;s pretty much self-sufficient.</p><p class="my-4 leading-relaxed text-label-dark">However, it&#x27;s not always 100% accurate. This is because I didn&#x27;t develop an <em>actual</em> QAS system that breaks down sentence structure using NLP and then searches for detected entities within a corpus. But this shows that <em>it&#x27;s possible to build something like this.</em> This system took me one hour to build from planning to completion; somebody with more time and dedication could build something even more accurate and scam the companies behind these apps for thousands of dollars.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Defending Against Cheaters</h1><p class="my-4 leading-relaxed text-label-dark">Preventing people from cheating, especially on devices they own, is extremely difficult. <a href="https://en.wikipedia.org/wiki/Sony_BMG_copy_protection_rootkit_scandal" class="text-link-dark">It&#x27;s also quite difficult to do right.</a> The dev mentioned in the Introduction, Toby Mellor, suggests a software check for screen capture devices. While a good first step, this doesn&#x27;t really prevent alternative methods of screen capture (such as just straight-up filming the screen with another camera). I suggest <em>fooling the underlying algorithms underneath</em>.</p><p class="my-4 leading-relaxed text-label-dark">&quot;How do you do this&quot;, you may ask? The answer is <em>adversarial perturbations</em>, a term coined by Evtimov et al. in the paper <em><a href="https://arxiv.org/abs/1707.08945" class="text-link-dark">Robust Physical-World Attacks on Deep Learning Models</a></em>. By making the text harder to be read by a bot, you are esssentially rate-limiting cheating. So how would this look like in practice? Maybe something like this, which completely fooled Tesseract:</p><p class="my-4 leading-relaxed text-label-dark"><img src="/static/img/hq-fooled.png" alt="A more confusing picture" class="mx-auto my-4 text-center"/></p><p class="my-4 leading-relaxed text-label-dark">(Well, not exactly that. That picture is quite horrible aesthetically)</p><p class="my-4 leading-relaxed text-label-dark">HQ needs to take advantage of its animated aesthetic and add a pattern, different fonts, particle effects, or something similar to confuse OCR systems.</p><p class="my-4 leading-relaxed text-label-dark">There&#x27;s already been research into how to fool OCR systems, such as this <a href="https://walkerart.org/magazine/sang-mun-defiant-typeface-nsa-privacy" class="text-link-dark">OCR-resistant font</a>, but I think that with the advent of deep learning, nothing short of overlaying/blending unpredictable patterns will prevent determined attackers from developing systems to cheat.</p><center>﹡ ﹡ ﹡</center><p class="my-4 leading-relaxed text-label-dark"><a href="https://news.ycombinator.com/item?id=15944171" class="text-link-dark">Discuss on Hacker News</a></p></main><div class="mt-32 mb-8 text-center text-secondaryLabel-dark"><p>Designed by Aditya in California.</p><p class="mt-4 text-xs">© 2020 Aditya Rathod. All rights reserved.</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/protect-trivia-from-bots","query":{},"buildId":"5agM1Js2uDvaRl5P3Um0A","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-1c161e633660818aa2c3.js"></script><script async="" data-next-page="/_app" src="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/_app.js"></script><script async="" data-next-page="/blog/protect-trivia-from-bots" src="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/blog/protect-trivia-from-bots.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.ca3e7fa29692f350ed1d.js" async=""></script><script src="/_next/static/chunks/99c2e695fd90543c92b695dce12c7a1926685b00.803f13d53fcc71fd0a07.js" async=""></script><script src="/_next/static/chunks/2ace1ae04e7892d3f9075ba0904f191743ac923b.ec503d89e80e050bcc1d.js" async=""></script><script src="/_next/static/runtime/main-ef776554a889c25f7403.js" async=""></script><script src="/_next/static/5agM1Js2uDvaRl5P3Um0A/_buildManifest.js" async=""></script><script src="/_next/static/5agM1Js2uDvaRl5P3Um0A/_ssgManifest.js" async=""></script></body></html>