<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@adibytes"/><meta name="twitter:creator" content="@adibytes"/><meta property="og:url" content="https://adityarathod.github.io/"/><meta property="og:locale" content="en_US"/><meta property="og:site_name" content="Aditya Rathod"/><title>Aditya Rathod: Protecting Trivia Apps from Cheaters</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="How people cheat at trivia games, and how the companies running them could stop this from happening."/><meta property="og:type" content="article"/><meta property="article:published_time" content="2017-12-17T01:00:00Z"/><meta property="article:author" content="https://adityarathod.github.io/"/><meta property="og:title" content="Protecting Trivia Apps from Cheaters"/><meta property="og:description" content="How people cheat at trivia games, and how the companies running them could stop this from happening."/><meta name="next-head-count" content="18"/><link rel="preload" href="/_next/static/css/79cbbe702e9dc0b23fea.css" as="style"/><link rel="stylesheet" href="/_next/static/css/79cbbe702e9dc0b23fea.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-9b68a5c6359188434519.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/99f422a92ff7083adb8a7d840734144fa7589f68.6e20768cbeee3c454a9f.js" as="script"/><link rel="preload" href="/_next/static/chunks/f8c918e9fc18bc7b000870c1a95f9e80b6c850b1.27fc33ba5cee71f73748.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-53c5376314af27b4fb7a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/protect-trivia-from-bots-52573229834703676e70.js" as="script"/></head><body><div id="__next"><div class="py-10 px-8 sm:px-8 md:px-10 lg:px-10 xl:px-10 max-w-5xl mx-auto"><header class="max-w-5xl py-4 mx-auto flex flex-row items-center justify-between sm:justify-between md:justify-start lg:justify-start xl:justify-start"><div class="mr-0 sm:mr-0 md:mr-8 lg:mr-10 xl:mr-10 text-center"><a class="font-bold text-2xl text-white opacity-100 hover:opacity-80" href="#">Aditya Rathod<span class="text-spring">.</span></a></div><nav class="hidden sm:hidden md:flex lg:flex xl:flex flex-1 flex-row items-center"><a class="text-white text-md opacity-80 hover:opacity-100 transition-opacity mx-10 sm:mx-10 md:mx-5 lg:mx-10 xl:mx-10" href="/">Home</a><a class="text-white text-md opacity-80 hover:opacity-100 transition-opacity mx-10 sm:mx-10 md:mx-5 lg:mx-10 xl:mx-10" href="/resume.pdf">Resume</a><a class="text-white text-md opacity-80 hover:opacity-100 transition-opacity mx-10 sm:mx-10 md:mx-5 lg:mx-10 xl:mx-10" href="/blog/">Blog</a></nav><div class="block sm:block md:hidden lg:hidden xl:hidden text-white"><button class="outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current w-5"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"></path></svg></button></div><div class="hidden sm:hidden md:flex lg:flex xl:flex ml-24"><a class="mx-3 text-white opacity-70 hover:opacity-100 transition-opacity" href="//github.com/adityarathod"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current w-5"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a><a class="mx-3 text-white opacity-70 hover:opacity-100 transition-opacity" href="//linkedin.com/in/aditya-rathod"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current w-5"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path></svg></a></div></header><main class="mt-12"><div class="mb-8 mx-auto max-w-xl"><h1 class="mb-2 text-3xl sm:text-3xl md:text-4xl lg:text-4xl xl:text-4xl font-bold text-center">Protecting Trivia Apps from Cheaters</h1><h2 class="text-cyan font-semibold text-center">December 16, 2017</h2></div><article class="prose prose-md text-white mx-auto"><p><em>This article has been mentioned in the media: <a href="https://www.theverge.com/2017/12/25/16817502/how-to-stop-hq-cheaters">The Verge</a>, <a href="https://www.washingtonpost.com/graphics/2018/business/hq-trivia/">Washington Post</a>, and <a href="https://techcrunch.com/2018/03/06/hq-trivia-questions/">TechCrunch</a></em>.</p><p><em>Mobile trivia apps</em>, such as HQ Trivia and The Q, modernize game show-style entertainment, allowing anyone to try their hand at winning cash prizes from their smartphone from anywhere. However, these applications are susceptible to cheaters and bots. For example, <a href="https://medium.com/@tobymellor/hq-trivia-using-bots-to-win-money-from-online-game-shows-ce2a1b11828b">a developer by the name of Toby Mellor</a> recently demonstrated how he created a near-realtime system to cheat on HQ Trivia. His post (linked above) details his use of Google cloud APIs to create this system.</p><p>While the demo was certainly impressive, I felt that I could improve on this system as a proof-of-concept. Armed with his post, I set out to make a better version of his system. However, I set some constraints on myself to make this more of a challenge:</p><ul><li>The system must run offline, with the exception of the QAS (question-and-answer system).</li><li>The system allow a human enough time to tap in the answer.</li><li>The system should require minimal human intervention, since a human will be using the system in real time.</li><li>The system must be functional within one hour.</li></ul><h2>Creating a Trivia-Cheating System</h2><h3>Design</h3><p>Instead of doing fancy (and slow) network-request hijacking using <code>mitmproxy</code>, I decided to run OCR at intervals on a portion of the image coming from the phone and pipe that to Google to provide a quick answer for the human operator to tap in. The system looks something like the following:</p><center><img src="/static/img/trivia-diagram.svg" alt="System diagram"/></center><p>TL;DR: a region of the iPhone&#x27;s screen will get captured, put through OCR, and then searched up on Google to get an answer.</p><h3>Implementation</h3><h4>Capturing the Screen</h4><p>First, I needed a way to capture only a region of the QuickTime window on my Mac into a temp file. That turned out to be trivial using the excellent CLI <code>screencapture</code> tool.</p><p>I initially used interactive selection, where the user manually makes a rectangular selection to capture:</p><pre class="language-bash"><code class="language-bash">screencapture -ci screens.png
</code></pre><p>However, I quickly realized that was extremely inefficient and that hardcoding in rect coordinates (a feature <code>screencapture</code> supports) was a much better option:</p><pre class="language-bash"><code class="language-bash"> screencapture -Rx,y,w,h screens.png
</code></pre><p><em>Note:</em> The rect coordinates are in the form <code>x,y,w,h</code>, with <code>(x, y)</code> being the coordinate of the top left corner.</p><h4>Optical Character Recognition</h4><p>It was time to find a passable OCR system that was fast and accurate. The only one I could think of was <a href="https://github.com/tesseract-ocr/tesseract"><code>tesseract</code></a>, an OCR engine maintained by Google. While not the best system in the world, its functionality out of the box was pretty great in my testing.</p><p>In order to extract text from our image using Tesseract, I used the following,</p><pre class="language-bash"><code class="language-bash">tesseract screens.png ocr
</code></pre><p>which takes the image and puts the extracted text into a file, <code>ocr.txt</code>. Now, it&#x27;s finally time to answer this question.</p><h4>Constructing a Google Search URL and Launching Chrome</h4><p>One little nasty step we have to do is to put our URL-encoded search query into a Google Search URL and then push that URL to a browser of choice (I used Google Chrome). I used Python for this step because of its familiarity.</p><h4>URL Encoding the Search Query</h4><p>A typical Google search URL looks something like this:</p><blockquote><p><em><a href="https://www.google.com/search&amp;q=what+is+life%3F">https://www.google.com/search&amp;q=what+is+life%3F</a></em></p></blockquote><p>Notice how the search query is a query string, the spaces are replaced with <code>+</code> signs, and special characters are encoded. Python 3 can do this easily with <code>urllib.parse.quote_plus(str)</code>.</p><p>So our code might look something like this:</p><pre class="language-python"><code class="language-python">query_encoded <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote_plus<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</code></pre><h4>Programmatically Launching Chrome</h4><p>Now, we need to pass the URL to Chrome programmatically. With a little bit of trial and error, I found out that the Unix binary, located at <code>/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome</code>, can open URLs without launching a new browser instance. Using that to our advantage, we simply pass the URL as a shell argument, and <em>violà!</em> It works.</p><h4>Stitching These Components Together</h4><p>Now, it&#x27;s time to mesh these components together. I decided to keep it simple and created a shell script to run each component and pass around data. My shell script ended up looking like this:</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/local/bin/zsh</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Realtime Screen OCR&quot;</span>
<span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Waiting for trigger&quot;</span>
    <span class="token builtin class-name">read</span>
    screencapture -Rx,y,w,h screens.png
    tesseract screens.png ocr
    <span class="token assign-left variable">OCR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> ocr.txt<span class="token variable">`</span></span>
    python3 launch.py <span class="token variable">$OCR</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Opened Chrome...waiting for next question&quot;</span>
<span class="token keyword">done</span>
</code></pre><p>The script waits for the enter key, grabs the predefined rect, runs OCR on it, and then launches Chrome. Then, it goes back to waiting for the enter key.</p><h3>Testing and Debrief</h3><p>I ran tests on this system using video replays of previous HQ Trivia shows. It worked well but struggled on the more difficult questions. Here&#x27;s a video of the system providing an instant answer to a question:</p><center><iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/F1m6ZyqIvhs?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe></center><p>In my opinion, this checks all the boxes–it works offline, it&#x27;s fast, and it&#x27;s pretty much self-sufficient.</p><p>However, it&#x27;s not always 100% accurate. This is because I didn&#x27;t develop an <em>actual</em> QAS system that breaks down sentence structure using NLP and then searches for detected entities within a corpus. But this shows that <em>it&#x27;s possible to build something like this.</em> This system took me one hour to build from planning to completion; somebody with more time and dedication could build something even more accurate and scam the companies behind these apps for thousands of dollars.</p><h2>Defending Against Cheaters</h2><p>Preventing people from cheating, especially on devices they own, is extremely difficult. <a href="https://en.wikipedia.org/wiki/Sony_BMG_copy_protection_rootkit_scandal">It&#x27;s also quite difficult to do right.</a> The dev mentioned in the Introduction, Toby Mellor, suggests a software check for screen capture devices. While a good first step, this doesn&#x27;t really prevent alternative methods of screen capture (such as just straight-up filming the screen with another camera). I suggest <em>fooling the underlying algorithms underneath</em>.</p><p>&quot;How do you do this&quot;, you may ask? The answer is <em>adversarial perturbations</em>, a term coined by Evtimov et al. in the paper <em><a href="https://arxiv.org/abs/1707.08945">Robust Physical-World Attacks on Deep Learning Models</a></em>. By making the text harder to be read by a bot, you are esssentially rate-limiting cheating. So how would this look like in practice? Maybe something like this, which completely fooled Tesseract:</p><center><img src="/static/img/hq-fooled.png" alt="A more confusing picture"/></center><p>(Well, not exactly that. That picture is quite horrible aesthetically)</p><p>HQ needs to take advantage of its animated aesthetic and add a pattern, different fonts, particle effects, or something similar to confuse OCR systems.</p><p>There&#x27;s already been research into how to fool OCR systems, such as this <a href="https://walkerart.org/magazine/sang-mun-defiant-typeface-nsa-privacy">OCR-resistant font</a>, but I think that with the advent of deep learning, nothing short of overlaying/blending unpredictable patterns will prevent determined attackers from developing systems to cheat.</p><p><a href="https://news.ycombinator.com/item?id=15944171">Discuss on Hacker News</a></p></article></main><div class="mt-32 mb-8 opacity-80"><p class="mt-4 text-xs">© 2020-present Aditya Rathod. All rights reserved.</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/protect-trivia-from-bots","query":{},"buildId":"KrVOhg791uFFBM5hnKmZP","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-526c8d3bfa37952c8205.js"></script><script src="/_next/static/chunks/main-9b68a5c6359188434519.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/99f422a92ff7083adb8a7d840734144fa7589f68.6e20768cbeee3c454a9f.js" async=""></script><script src="/_next/static/chunks/f8c918e9fc18bc7b000870c1a95f9e80b6c850b1.27fc33ba5cee71f73748.js" async=""></script><script src="/_next/static/chunks/pages/_app-53c5376314af27b4fb7a.js" async=""></script><script src="/_next/static/chunks/pages/blog/protect-trivia-from-bots-52573229834703676e70.js" async=""></script><script src="/_next/static/KrVOhg791uFFBM5hnKmZP/_buildManifest.js" async=""></script><script src="/_next/static/KrVOhg791uFFBM5hnKmZP/_ssgManifest.js" async=""></script></body></html>