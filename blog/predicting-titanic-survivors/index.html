<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta property="og:title" content="Predicting Titanic Survivors: My First Machine Learning Model"/><meta property="og:description" content="Learn how to build a machine learning model to predict Titanic survivors based on the Kaggle dataset."/><meta property="og:type" content="article"/><meta name="description" content="Learn how to build a machine learning model to predict Titanic survivors based on the Kaggle dataset."/><title>Predicting Titanic Survivors: My First Machine Learning Model</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" crossorigin="anonymous"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/a32ffd38482d2ae5657c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a32ffd38482d2ae5657c.css"/><link rel="preload" href="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/blog/predicting-titanic-survivors.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ca3e7fa29692f350ed1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/99c2e695fd90543c92b695dce12c7a1926685b00.803f13d53fcc71fd0a07.js" as="script"/><link rel="preload" href="/_next/static/chunks/2ace1ae04e7892d3f9075ba0904f191743ac923b.ec503d89e80e050bcc1d.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-ef776554a889c25f7403.js" as="script"/></head><body><div id="__next"><div class="my-8 mx-auto w-full"><button class="absolute text-sm font-bold outline-none text-systemBlue-dark" style="top:10px;right:10px;outline:none">dark<!-- --> mode</button><div class="mb-8"><h1 class="text-3xl text-center font-bold text-label-dark">Aditya Rathod</h1><div class="px-4 max-w-lg mx-auto my-0 flex flex-row items-center justify-between"><a href="/" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">home</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="//github.com/adityarathod" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">github</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="//linkedin.com/in/aditya-rathod" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">linkedin</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="/resume.pdf" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">resumé</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="/blog" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">blog</a></div></div></div><main class="mx-auto my-0 mt-4 max-w-5xl px-8 py-6" style="border-radius:15px"><h1 class="text-label-dark text-4xl font-bold mx-auto my-0 max-w-xl mb-6 text-center">Predicting Titanic Survivors: My First Machine Learning Model</h1><div class="mb-6 text-center text-secondaryLabel-dark">August 4, 2018</div><h1 class="text-2xl font-bold mt-4 text-label-dark">Introduction</h1><p class="my-4 leading-relaxed text-label-dark">I&#x27;ve been taking the <a href="https://www.coursera.org/learn/machine-learning" class="text-link-dark">Machine Learning course by Dr. Andrew Ng</a> online through Coursera, and so far it&#x27;s been an enlightening and enjoyable experience. While I&#x27;ve been taking lots of notes on the equations and implementation details on linear and logistic regression models, I thought it would be a fun weekend exercise to implement these algorithms from scratch using my favorite toolkit: Python, Pandas, and Numpy.</p><p class="my-4 leading-relaxed text-label-dark">Special thanks to Dr. Ng and his course staff for preparing such high-quality course material. Many of these equations and explanations are based on notes from the course lectures, and I have paraphrased many of the explanations here in my own words as best as possible.</p><h2 class="text-xl font-medium my-2 text-label-dark">The Dataset</h2><p class="my-4 leading-relaxed text-label-dark">The dataset I decided to work with for this project was the was the <a href="https://www.kaggle.com/c/titanic" class="text-link-dark">Kaggle Titanic dataset</a>, which was recommended as a beginner dataset to work with.</p><p class="my-4 leading-relaxed text-label-dark"><img src="/static/img/titanic-training.png" alt="Titanic Dataset Data" class="mx-auto my-4 text-center"/>
<em><strong>Figure 1:</strong> Structure of the dataset</em></p><p class="my-4 leading-relaxed text-label-dark">Based on the <code>train.csv</code> file included in the dataset download, it was clear that this was a binary classification problem. Since I only know how to implement linear and logistic regression models so far, I decided to use logistic regression for this problem.</p><h2 class="text-xl font-medium my-2 text-label-dark">Project Structure</h2><p class="my-4 leading-relaxed text-label-dark">For reference, my project directory was structured like this:</p><pre class="language-wiki"><code class="language-wiki">.
├── Makefile
├── data
│   ├── gender_submission.csv
│   ├── test.csv
│   └── train.csv
└── src
    └── Titanic.ipynb
</code></pre><p class="my-4 leading-relaxed text-label-dark">The <code>Makefile</code> in the main directory has a fake target to make launching <code>jupyter lab</code> easier.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Step 1: Preparing the Data</h1><p class="my-4 leading-relaxed text-label-dark">I first needed to clean the data before I could use it. In order to do that, I first brought the data into a pandas <code>DataFrame</code>:</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../data/train.csv&quot;</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Then, I dropped the columns that I couldn&#x27;t convert into numbers:</p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;Name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;PassengerId&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Ticket&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Cabin&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark"><strong>Note:</strong> Having fewer features means the model was less accurate than it could be. Some clever feature engineering would have made use of these columns somehow, but as I was a beginner, I didn&#x27;t really know what to do with these features other than throw them out.</p><p class="my-4 leading-relaxed text-label-dark">Next, I converted all of the textual features into numerical values roughly within the range $ (-1, 1) $.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sex_to_numerical</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">embarkation_to_numerical</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token string">&quot;Q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
df<span class="token punctuation">.</span>Sex <span class="token operator">=</span> df<span class="token punctuation">.</span>Sex<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>sex_to_numerical<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Embarked <span class="token operator">=</span> df<span class="token punctuation">.</span>Embarked<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>embarkation_to_numerical<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Next, I normalized the data using a simple approach: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">(value - max)/range</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.02778em">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em">g</span><span class="mord mathdefault">e</span></span></span></span></span>, where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>−</mo><mi>m</mi><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">range = max - min</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathdefault" style="margin-right:0.02778em">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em">g</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span></span></span></span></span>.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">normalize_ticket_class</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>cl <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token keyword">def</span> <span class="token function">normalize_fare</span><span class="token punctuation">(</span>farecol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    range_f <span class="token operator">=</span> farecol<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> farecol<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    max_f <span class="token operator">=</span> farecol<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> farecol<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> fare<span class="token punctuation">:</span> <span class="token punctuation">(</span>fare <span class="token operator">-</span> max_f<span class="token punctuation">)</span><span class="token operator">/</span>range_f<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Fare <span class="token operator">=</span> normalize_fare<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Fare<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Pclass <span class="token operator">=</span> df<span class="token punctuation">.</span>Pclass<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>normalize_ticket_class<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Then, I needed to convert all missing/<code>NaN</code> values in the <code>Age</code> column to numbers so that I didn&#x27;t need to throw that feature out:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">de_nan_age</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> a
df<span class="token punctuation">.</span>Age <span class="token operator">=</span> df<span class="token punctuation">.</span>Age<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>de_nan_age<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">After all this processing, the <code>DataFrame</code> looks like this:</p><table class="table-auto my-6 mx-auto text-label-dark"><thead><tr><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Index</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Survived</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Pclass</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Sex</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Age</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">SibSp</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Parch</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Fare</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">Embarked</th></tr></thead><tbody><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">22.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-0.985848942437792</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td></tr><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-1.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">38.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-0.8608642646173593</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-1</td></tr><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">2</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">26.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-0.9845314301820002</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td></tr><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">3</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-1.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">35.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-0.8963557025443796</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td></tr><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">4</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">35.0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">-0.9842874464309276</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td></tr></tbody></table><p class="my-4 leading-relaxed text-label-dark">Now, I&#x27;ll split up the <code>DataFrame</code> into two <code>np.array</code>s, one with the features, the other with the labels:</p><pre class="language-python"><code class="language-python">features <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;Survived&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
labels <span class="token operator">=</span> df<span class="token punctuation">.</span>Survived<span class="token punctuation">.</span>values
</code></pre><p class="my-4 leading-relaxed text-label-dark">Add an <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_0 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span> column to the features array so everything looks clean:</p><pre class="language-python"><code class="language-python">x_zero_column <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
features <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x_zero_column<span class="token punctuation">,</span> features<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Using the features and labels arrays, create a <em>design matrix</em> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.07847em">X</span></span></span></span></span> and the <em>label vector</em> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathdefault" style="margin-right:0.03588em">y</span></span></span></span></span>:</p><pre class="language-python"><code class="language-python">X <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
<span class="token comment"># y needs to be transposed from a row vector to a column vector</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">.</span>T
</code></pre><p class="my-4 leading-relaxed text-label-dark">The data is now ready to be used.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Step 2: Define Variables</h1><p class="my-4 leading-relaxed text-label-dark">Using <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.07847em">X</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathdefault" style="margin-right:0.03588em">y</span></span></span></span></span>, it&#x27;s time to define some variables that are important to the implmentation of the <em>cost function</em> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.09618em">J</span></span></span></span></span>:</p><pre class="language-python"><code class="language-python"><span class="token comment"># m is the number of training samples</span>
m <span class="token operator">=</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># n is the number of features, in this case we are not counting the x_0 column</span>
n <span class="token operator">=</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Let&#x27;s define the parameter <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span> as a <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>-dimensional vector, initially filled with zeros:</p><pre class="language-python"><code class="language-python">theta <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
</code></pre><p class="my-4 leading-relaxed text-label-dark">And let&#x27;s set a learning rate <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.0037em">α</span></span></span></span></span>, in this case I just chose an arbitrary value:</p><pre class="language-python"><code class="language-python">alpha <span class="token operator">=</span> <span class="token number">0.001</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">It&#x27;s important to choose the right <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.0037em">α</span></span></span></span></span>, because a smaller value may make the model slower to converge, while a larger value might make the model never converge.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Step 3: Define Functions</h1><h2 class="text-xl font-medium my-2 text-label-dark">The Sigmoid Function</h2><p class="my-4 leading-relaxed text-label-dark">One of the most important equations needed for logistic regression is the sigmoid function, which looks like this:</p><center><iframe src="https://www.desmos.com/calculator/hvlhutwrba?embed" width="600px" height="300px" style="border:1px solid #ccc" frameBorder="0"></iframe></center><p class="my-4 leading-relaxed text-label-dark">The equation for the sigmoid function is <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>z</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">g(z) = \frac{1}{1+ e^{-z}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.03588em">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026642857142857em"><span style="top:-2.786em;margin-right:0.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.04398em">z</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p class="my-4 leading-relaxed text-label-dark">Thanks to numpy, it&#x27;s very simple to define an element-wise vectorized sigmoid function, which will our code much more efficient:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>z<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>divide<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>
</code></pre><h2 class="text-xl font-medium my-2 text-label-dark">The Hypothesis Function</h2><p class="my-4 leading-relaxed text-label-dark">To generate a matrix of predictions using the parameter vector <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span>, we define our hypothesis function <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span> as follows:</p><p class="my-4 leading-relaxed text-label-dark"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><mi>X</mi><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x) = g(X\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.03588em">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em">X</span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></p><p class="my-4 leading-relaxed text-label-dark">where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.07847em">X</span></span></span></span></span> is the design matrix.</p><p class="my-4 leading-relaxed text-label-dark">But what does the output of this function mean? <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span> is actually outputting the <em>probability</em> that the output is 1. Formally, this function gives you the probablility that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathdefault" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>, given <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault">x</span></span></span></span></span>, parameterized by <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span> (mathematically, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y=1|x;\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.13889em">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mord">∣</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span>.</p><p class="my-4 leading-relaxed text-label-dark">In Python, we can define the hypothesis function similarly:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">hypothesis</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> sigmoid<span class="token punctuation">(</span>x <span class="token operator">*</span> theta<span class="token punctuation">)</span>
</code></pre><h2 class="text-xl font-medium my-2 text-label-dark">The Cost Function</h2><p class="my-4 leading-relaxed text-label-dark">In order for the logistic regression algorithm to <em>learn</em>, it must have some function to minimize. This function is called the <em>cost</em> or <em>loss</em> function.</p><p class="my-4 leading-relaxed text-label-dark">For logistic regression, the cost function is defined as:</p><p class="my-4 leading-relaxed text-label-dark"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><mo fence="false">(</mo><mo>−</mo><msup><mi>y</mi><mi>T</mi></msup><mi>log</mi><mo>⁡</mo><mrow><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo>−</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msup><mi>y</mi><mi>T</mi></msup><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo fence="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta) = \frac{1}{m} \bigg(-y^T \log{h(x)}- (1-y^T)\log{(1-h(x))}\bigg)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.09618em">J</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size3">(</span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em">T</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span></span><span class="mord"><span class="delimsizing size3">)</span></span></span></span></span></span></p><p class="my-4 leading-relaxed text-label-dark">The Python code for this function came out to be too long to write out on one line, so the math is done on three separate lines.</p><p class="my-4 leading-relaxed text-label-dark"><strong>Note:</strong> <code>cost</code> came out to be a 1x1 numpy matrix and was converted into a singular floating-point value at the end.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    hypo <span class="token operator">=</span> hypothesis<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    part1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>hypo<span class="token punctuation">)</span>
    part2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> hypo<span class="token punctuation">)</span>
    cost <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>m<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>part1 <span class="token operator">-</span> part2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cost<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre><h2 class="text-xl font-medium my-2 text-label-dark">The Gradient Descent Function</h2><p class="my-4 leading-relaxed text-label-dark">The last (and probably most important) piece of this machine learning algorithm is the <code>gradient_descent_step</code> function, which calculates the gradient for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span>.</p><p class="my-4 leading-relaxed text-label-dark">The update rule for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span> is as follows:</p><p class="my-4 leading-relaxed text-label-dark">$$ \theta := \theta - \frac{\alpha}{m}X^T(g(X\theta)-\vec{y}) $$</p><p class="my-4 leading-relaxed text-label-dark">This is simple to implement in Python as a one-liner:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gradient_descent_step</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> theta <span class="token operator">-</span> <span class="token punctuation">(</span>alpha<span class="token operator">/</span>m<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>hypothesis<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">-</span> y<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">With all the necessary functions implemented, it&#x27;s time to actually learn the parameters <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span>.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Step 4: Run the Learning Algorithm</h1><p class="my-4 leading-relaxed text-label-dark">To run the learning algorithm, let&#x27;s create a loop in which <code>gradient_descent_step</code> is run every iteration:</p><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1630000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    theta <span class="token operator">=</span> gradient_descent_step<span class="token punctuation">(</span>theta<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">I found experimentally that after 1.63 million iterations, the cost delta after each iteration of Gradient Descent is negligible.</p><p class="my-4 leading-relaxed text-label-dark">After the loop was run, the cost was approximately <code>0.45085533814736584</code>.</p><p class="my-4 leading-relaxed text-label-dark">Before we do anything else, let&#x27;s save the optimal <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span></span></span></span></span> in a file:</p><pre class="language-python"><code class="language-python">np<span class="token punctuation">.</span>savetxt<span class="token punctuation">(</span><span class="token string">&quot;theta.txt&quot;</span><span class="token punctuation">,</span> theta<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Once saved, it can be loaded back like this:</p><pre class="language-python"><code class="language-python">theta <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">&quot;theta.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
theta <span class="token operator">=</span> theta<span class="token punctuation">.</span>T
</code></pre><h1 class="text-2xl font-bold mt-4 text-label-dark">Step 5: Run the Model on Test Data</h1><h2 class="text-xl font-medium my-2 text-label-dark">Create the Prediction Function</h2><p class="my-4 leading-relaxed text-label-dark">Using the <code>hypothesis(x)</code> function, let&#x27;s define a function that outputs <code>1</code> if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>≥</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">P(y=1|x;\theta) ≥ 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.13889em">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mord">∣</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathdefault" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span></span> or <code>0</code> otherwise:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    h <span class="token operator">=</span> hypothesis<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    comp <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;=</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> comp<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark"><code>predict(x)</code> runs predictions on a matrix element-wise and converts them into numerical binary values.</p><h2 class="text-xl font-medium my-2 text-label-dark">Import the Test Data</h2><p class="my-4 leading-relaxed text-label-dark">Now, it&#x27;s time to bring in the test data, preparing it like we did for the training data:</p><pre class="language-python"><code class="language-python">test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../data/test.csv&quot;</span><span class="token punctuation">)</span>
test_df <span class="token operator">=</span> test_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;Name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;PassengerId&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Ticket&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Cabin&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Pclass <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Pclass<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>normalize_ticket_class<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Sex <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Sex<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>sex_to_numerical<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Fare <span class="token operator">=</span> normalize_fare<span class="token punctuation">(</span>test_df<span class="token punctuation">.</span>Fare<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Embarked <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Embarked<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>embarkation_to_numerical<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Age <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Age<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>de_nan_age<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Let&#x27;s add in the <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> column like before:</p><pre class="language-python"><code class="language-python">test_X <span class="token operator">=</span> test_df<span class="token punctuation">.</span>values
x_zero_column_test <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>test_df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x_zero_column_test<span class="token punctuation">,</span> test_X<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
</code></pre><h2 class="text-xl font-medium my-2 text-label-dark">Generate Predictions</h2><p class="my-4 leading-relaxed text-label-dark">Using the <code>test_X</code> matrix, let&#x27;s generate predictions and save them to a file:</p><pre class="language-python"><code class="language-python">predictions <span class="token operator">=</span> predict<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>savetxt<span class="token punctuation">(</span><span class="token string">&quot;predictions.txt&quot;</span><span class="token punctuation">,</span> predictions<span class="token punctuation">)</span>
</code></pre><h2 class="text-xl font-medium my-2 text-label-dark">Prepare Submission For Kaggle</h2><p class="my-4 leading-relaxed text-label-dark">The <code>predictions.txt</code> file isn&#x27;t in the format that Kaggle needs for submission. Let&#x27;s put our predictions into a pandas <code>DataFrame</code> along with the <code>PassengerId</code> column:</p><pre class="language-python"><code class="language-python"><span class="token comment"># Function to flatten nested lists</span>
flatten <span class="token operator">=</span> <span class="token keyword">lambda</span> l<span class="token punctuation">:</span> <span class="token punctuation">[</span>item <span class="token keyword">for</span> sublist <span class="token keyword">in</span> l <span class="token keyword">for</span> item <span class="token keyword">in</span> sublist<span class="token punctuation">]</span>
<span class="token comment"># Temp DataFrame to get PassengerIds</span>
temp_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../data/test.csv&quot;</span><span class="token punctuation">)</span>
submission_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
submission_df<span class="token punctuation">[</span><span class="token string">&quot;PassengerId&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp_df<span class="token punctuation">[</span><span class="token string">&quot;PassengerId&quot;</span><span class="token punctuation">]</span>
submission_df<span class="token punctuation">[</span><span class="token string">&quot;Survived&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>flatten<span class="token punctuation">(</span>predictions<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Let&#x27;s export to CSV for upload to Kaggle:</p><pre class="language-python"><code class="language-python">submission_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&quot;kaggle_submission.csv&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre><h1 class="text-2xl font-bold mt-4 text-label-dark">Results</h1><p class="my-4 leading-relaxed text-label-dark">According to Kaggle&#x27;s online judge, my model had an accuracy of 74.641% on the test dataset, which is not great by machine learning standards, but was nevertheless exciting for me, since I implemented the model (almost) from scratch.</p><p class="my-4 leading-relaxed text-label-dark">This was an improvement over my submission from last year, which was a linear regression algorithm using <code>scikit-learn</code>.</p><p class="my-4 leading-relaxed text-label-dark"><img src="/static/img/kaggle-score-logistic.png" alt="Kaggle leaderboard screenshot" class="mx-auto my-4 text-center"/>
<em><strong>Figure 2:</strong> Pics or it didn&#x27;t happen</em></p><h1 class="text-2xl font-bold mt-4 text-label-dark">Conclusion</h1><p class="my-4 leading-relaxed text-label-dark">This project was also a chance to dip my toes into creating Machine Learning models for use on real data, taking the theory and applying it to a real-world problem.</p><p class="my-4 leading-relaxed text-label-dark">Based on my results, I can also conclude that feature engineering (such as using polynomial features) may be needed to achieve a higher accuracy. Additionally, using something like neural networks may be a better option to achieve higher accuracy, due to their ability to learn complex nonlinear hypotheses.</p><p class="my-4 leading-relaxed text-label-dark">If you are a machine learning expert and have suggestions on how I could improve the accuracy of my toy model, I would love to hear them! Comment on the Hacker News thread linked below or email me at the address below.</p><p class="my-4 leading-relaxed text-label-dark"><a href="https://news.ycombinator.com/item?id=17692378" class="text-link-dark">Discuss on Hacker News</a></p></main><div class="mt-32 mb-8 text-center text-secondaryLabel-dark"><p>Designed by Aditya in California.</p><p class="mt-4 text-xs">© 2020 Aditya Rathod. All rights reserved.</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/predicting-titanic-survivors","query":{},"buildId":"5agM1Js2uDvaRl5P3Um0A","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-1c161e633660818aa2c3.js"></script><script async="" data-next-page="/_app" src="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/_app.js"></script><script async="" data-next-page="/blog/predicting-titanic-survivors" src="/_next/static/5agM1Js2uDvaRl5P3Um0A/pages/blog/predicting-titanic-survivors.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.ca3e7fa29692f350ed1d.js" async=""></script><script src="/_next/static/chunks/99c2e695fd90543c92b695dce12c7a1926685b00.803f13d53fcc71fd0a07.js" async=""></script><script src="/_next/static/chunks/2ace1ae04e7892d3f9075ba0904f191743ac923b.ec503d89e80e050bcc1d.js" async=""></script><script src="/_next/static/runtime/main-ef776554a889c25f7403.js" async=""></script><script src="/_next/static/5agM1Js2uDvaRl5P3Um0A/_buildManifest.js" async=""></script><script src="/_next/static/5agM1Js2uDvaRl5P3Um0A/_ssgManifest.js" async=""></script></body></html>