<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@adibytes"/><meta name="twitter:creator" content="@adibytes"/><meta property="og:url" content="https://adityarathod.github.io/"/><meta property="og:locale" content="en_US"/><meta property="og:site_name" content="Aditya Rathod"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" crossorigin="anonymous"/><title>Aditya Rathod: Predicting Titanic Survivors: My First Machine Learning Model</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Learn how to build a machine learning model to predict Titanic survivors based on the Kaggle dataset."/><meta property="og:type" content="article"/><meta property="article:published_time" content="2018-08-04T23:00:00Z"/><meta property="article:author" content="https://adityarathod.github.io/"/><meta property="og:title" content="Predicting Titanic Survivors: My First Machine Learning Model"/><meta property="og:description" content="Learn how to build a machine learning model to predict Titanic survivors based on the Kaggle dataset."/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/260ca1663867b3cb71e4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/260ca1663867b3cb71e4.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-2a5a419014a6f9bc39d0.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-92300432a1172ef1338b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-05874ade60c38bd3a774.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-5d52e45cbe5a5e1337a9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/predicting-titanic-survivors-261966f5d9712bc6903c.js" as="script"/></head><body><div id="__next"><div class="py-10 px-8 sm:px-8 md:px-10 lg:px-10 xl:px-10 max-w-5xl mx-auto"><header class="max-w-5xl py-4 mx-auto flex flex-row items-center justify-between sm:justify-between md:justify-start lg:justify-start xl:justify-start"><div class="mr-0 sm:mr-0 md:mr-8 lg:mr-10 xl:mr-10 text-center"><a class="font-bold text-2xl text-white opacity-100 hover:opacity-80" href="#">Aditya Rathod<span class="text-spring">.</span></a></div><nav class="hidden sm:hidden md:flex lg:flex xl:flex flex-1 flex-row items-center"><a class="text-white text-md opacity-80 hover:opacity-100 transition-opacity mx-10 sm:mx-10 md:mx-5 lg:mx-10 xl:mx-10" href="/">Home</a><a class="text-white text-md opacity-80 hover:opacity-100 transition-opacity mx-10 sm:mx-10 md:mx-5 lg:mx-10 xl:mx-10" href="/resume.pdf">Resume</a><a class="text-white text-md opacity-80 hover:opacity-100 transition-opacity mx-10 sm:mx-10 md:mx-5 lg:mx-10 xl:mx-10" href="/blog/">Blog</a></nav><div class="block sm:block md:hidden lg:hidden xl:hidden text-white"><button class="outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current w-5"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"></path></svg></button></div><div class="hidden sm:hidden md:flex lg:flex xl:flex ml-24"><a class="mx-3 text-white opacity-70 hover:opacity-100 transition-opacity" href="//github.com/adityarathod"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current w-5"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a><a class="mx-3 text-white opacity-70 hover:opacity-100 transition-opacity" href="//linkedin.com/in/aditya-rathod"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current w-5"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path></svg></a></div></header><main class="mt-24"><div class="mb-8 mx-auto max-w-xl"><h1 class="mb-2 text-3xl sm:text-3xl md:text-4xl lg:text-4xl xl:text-4xl font-bold text-center">Predicting Titanic Survivors: My First Machine Learning Model</h1><h2 class="text-cyan font-semibold text-center">August 4, 2018</h2></div><article class="prose prose-md text-white mx-auto"><p>I&#x27;ve been taking the <a href="https://www.coursera.org/learn/machine-learning">Machine Learning course by Dr. Andrew Ng</a> online through Coursera, and so far it&#x27;s been an enlightening and enjoyable experience. While I&#x27;ve been taking lots of notes on the equations and implementation details on linear and logistic regression models, I thought it would be a fun weekend exercise to implement these algorithms from scratch using my favorite toolkit: Python, Pandas, and Numpy.</p><p>Special thanks to Dr. Ng and his course staff for preparing such high-quality course material. Many of these equations and explanations are based on notes from the course lectures, and I have paraphrased many of the explanations here in my own words as best as possible.</p><h2>The Dataset</h2><p>The dataset I decided to work with for this project was the was the <a href="https://www.kaggle.com/c/titanic">Kaggle Titanic dataset</a>, which was recommended as a beginner dataset to work with.</p><p><img src="/static/img/titanic-training.png" alt="Titanic Dataset Data"/>
<em><strong>Figure 1:</strong> Structure of the dataset</em></p><p>Based on the <code>train.csv</code> file included in the dataset download, it was clear that this was a binary classification problem. Since I only know how to implement linear and logistic regression models so far, I decided to use logistic regression for this problem.</p><h2>Project Structure</h2><p>For reference, my project directory was structured like this:</p><pre class="language-wiki"><code class="language-wiki">.
├── Makefile
├── data
│   ├── gender_submission.csv
│   ├── test.csv
│   └── train.csv
└── src
    └── Titanic.ipynb
</code></pre><p>The <code>Makefile</code> in the main directory has a fake target to make launching <code>jupyter lab</code> easier.</p><h2>Preparing the Data</h2><p>I first needed to clean the data before I could use it. In order to do that, I first brought the data into a pandas <code>DataFrame</code>:</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../data/train.csv&quot;</span><span class="token punctuation">)</span>
</code></pre><p>Then, I dropped the columns that I couldn&#x27;t convert into numbers:</p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;Name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;PassengerId&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Ticket&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Cabin&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p><strong>Note:</strong> Having fewer features means the model was less accurate than it could be. Some clever feature engineering would have made use of these columns somehow, but as I was a beginner, I didn&#x27;t really know what to do with these features other than throw them out.</p><p>Next, I converted all of the textual features into numerical values roughly within the range <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(-1, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sex_to_numerical</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">embarkation_to_numerical</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token string">&quot;Q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
df<span class="token punctuation">.</span>Sex <span class="token operator">=</span> df<span class="token punctuation">.</span>Sex<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>sex_to_numerical<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Embarked <span class="token operator">=</span> df<span class="token punctuation">.</span>Embarked<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>embarkation_to_numerical<span class="token punctuation">)</span>
</code></pre><p>I then normalized the data using a simple approach: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">(value - max)/range</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span></span></span></span></span>, where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>−</mo><mi>m</mi><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">range = max - min</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em"></span><span class="mord mathnormal">min</span></span></span></span></span>.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">normalize_ticket_class</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>cl <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token keyword">def</span> <span class="token function">normalize_fare</span><span class="token punctuation">(</span>farecol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    range_f <span class="token operator">=</span> farecol<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> farecol<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    max_f <span class="token operator">=</span> farecol<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> farecol<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> fare<span class="token punctuation">:</span> <span class="token punctuation">(</span>fare <span class="token operator">-</span> max_f<span class="token punctuation">)</span><span class="token operator">/</span>range_f<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Fare <span class="token operator">=</span> normalize_fare<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Fare<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>Pclass <span class="token operator">=</span> df<span class="token punctuation">.</span>Pclass<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>normalize_ticket_class<span class="token punctuation">)</span>
</code></pre><p>I needed to convert all missing/<code>NaN</code> values in the <code>Age</code> column to numbers so that I didn&#x27;t need to throw that feature out:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">de_nan_age</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> a
df<span class="token punctuation">.</span>Age <span class="token operator">=</span> df<span class="token punctuation">.</span>Age<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>de_nan_age<span class="token punctuation">)</span>
</code></pre><p>After all this processing, the <code>DataFrame</code> looks like this:</p><table><thead><tr><th>Index</th><th>Survived</th><th>Pclass</th><th>Sex</th><th>Age</th><th>SibSp</th><th>Parch</th><th>Fare</th><th>Embarked</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0.0</td><td>0</td><td>22.0</td><td>1</td><td>0</td><td>-0.985848942437792</td><td>1</td></tr><tr><td>1</td><td>1</td><td>-1.0</td><td>1</td><td>38.0</td><td>1</td><td>0</td><td>-0.8608642646173593</td><td>-1</td></tr><tr><td>2</td><td>1</td><td>0.0</td><td>1</td><td>26.0</td><td>0</td><td>0</td><td>-0.9845314301820002</td><td>1</td></tr><tr><td>3</td><td>1</td><td>-1.0</td><td>1</td><td>35.0</td><td>1</td><td>0</td><td>-0.8963557025443796</td><td>1</td></tr><tr><td>4</td><td>0</td><td>0.0</td><td>0</td><td>35.0</td><td>0</td><td>0</td><td>-0.9842874464309276</td><td>1</td></tr></tbody></table><p>Now, I&#x27;ll split up the <code>DataFrame</code> into two <code>np.array</code>s, one with the features, the other with the labels:</p><pre class="language-python"><code class="language-python">features <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;Survived&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
labels <span class="token operator">=</span> df<span class="token punctuation">.</span>Survived<span class="token punctuation">.</span>values
</code></pre><p>Add an <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_0 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span> column to the features array so everything looks clean:</p><pre class="language-python"><code class="language-python">x_zero_column <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
features <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x_zero_column<span class="token punctuation">,</span> features<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><p>Using the features and labels arrays, create a <em>design matrix</em> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.07847em">X</span></span></span></span></span> and the <em>label vector</em> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>:</p><pre class="language-python"><code class="language-python">X <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
<span class="token comment"># y needs to be transposed from a row vector to a column vector</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">.</span>T
</code></pre><p>The data is now ready to be used.</p><h2>Define Variables</h2><p>Using <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.07847em">X</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>, it&#x27;s time to define some variables that are important to the implmentation of the <em>cost function</em> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.09618em">J</span></span></span></span></span>:</p><pre class="language-python"><code class="language-python"><span class="token comment"># m is the number of training samples</span>
m <span class="token operator">=</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># n is the number of features, in this case we are not counting the x_0 column</span>
n <span class="token operator">=</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>
</code></pre><p>Let&#x27;s define the parameter <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span> as a <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>-dimensional vector, initially filled with zeros:</p><pre class="language-python"><code class="language-python">theta <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
</code></pre><p>And let&#x27;s set a learning rate <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.0037em">α</span></span></span></span></span>, in this case I just chose an arbitrary value:</p><pre class="language-python"><code class="language-python">alpha <span class="token operator">=</span> <span class="token number">0.001</span>
</code></pre><p>It&#x27;s important to choose the right <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.0037em">α</span></span></span></span></span>, because a smaller value may make the model slower to converge, while a larger value might make the model never converge.</p><h2>Define Functions</h2><h3>The Sigmoid Function</h3><p>One of the most important equations needed for logistic regression is the sigmoid function, which looks like this:</p><center><iframe src="https://www.desmos.com/calculator/hvlhutwrba?embed" width="600px" height="300px" style="border:1px solid #ccc" frameBorder="0"></iframe></center><p>The equation for the sigmoid function is <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>z</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">g(z) = \frac{1}{1+ e^{-z}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026642857142857em"><span style="top:-2.786em;margin-right:0.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.04398em">z</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Thanks to numpy, it&#x27;s very simple to define an element-wise vectorized sigmoid function, which will our code much more efficient:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>z<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>divide<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>
</code></pre><h3>The Hypothesis Function</h3><p>To generate a matrix of predictions using the parameter vector <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span>, we define our hypothesis function <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> as follows:</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><mi>X</mi><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x) = g(X\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">Xθ</span><span class="mclose">)</span></span></span></span></span></p><p>where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.07847em">X</span></span></span></span></span> is the design matrix.</p><p>But what does the output of this function mean? <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> is actually outputting the <em>probability</em> that the output is 1. Formally, this function gives you the probablility that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>, given <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">x</span></span></span></span></span>, parameterized by <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span> (mathematically, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y=1|x;\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1∣</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span>.</p><p>In Python, we can define the hypothesis function similarly:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">hypothesis</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> sigmoid<span class="token punctuation">(</span>x <span class="token operator">*</span> theta<span class="token punctuation">)</span>
</code></pre><h3>The Cost Function</h3><p>In order for the logistic regression algorithm to <em>learn</em>, it must have some function to minimize. This function is called the <em>cost</em> or <em>loss</em> function.</p><p>For logistic regression, the cost function is defined as:</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><mo fence="false" stretchy="true" minsize="2.4em" maxsize="2.4em">(</mo><mo>−</mo><msup><mi>y</mi><mi>T</mi></msup><mi>log</mi><mo>⁡</mo><mrow><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo>−</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msup><mi>y</mi><mi>T</mi></msup><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>h</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo fence="false" stretchy="true" minsize="2.4em" maxsize="2.4em">)</mo></mrow><annotation encoding="application/x-tex">J(\theta) = \frac{1}{m} \bigg(-y^T \log{h(x)}- (1-y^T)\log{(1-h(x))}\bigg)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.09618em">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size3">(</span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">T</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span><span class="mord"><span class="delimsizing size3">)</span></span></span></span></span></span></p><p>The Python code for this function came out to be too long to write out on one line, so the math is done on three separate lines.</p><p><strong>Note:</strong> <code>cost</code> came out to be a 1x1 numpy matrix and was converted into a singular floating-point value at the end.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    hypo <span class="token operator">=</span> hypothesis<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    part1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>hypo<span class="token punctuation">)</span>
    part2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> hypo<span class="token punctuation">)</span>
    cost <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>m<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>part1 <span class="token operator">-</span> part2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cost<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre><h3>The Gradient Descent Function</h3><p>The last (and probably most important) piece of this machine learning algorithm is the <code>gradient_descent_step</code> function, which calculates the gradient for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span>.</p><p>The update rule for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span> is as follows:</p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>:</mo><mo>=</mo><mi>θ</mi><mo>−</mo><mfrac><mi>α</mi><mi>m</mi></mfrac><msup><mi>X</mi><mi>T</mi></msup><mo stretchy="false">(</mo><mi>g</mi><mo stretchy="false">(</mo><mi>X</mi><mi>θ</mi><mo stretchy="false">)</mo><mo>−</mo><mover accent="true"><mi>y</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta := \theta - \frac{\alpha}{m}X^T(g(X\theta)-\vec{y})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.186331em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em">α</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em">T</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">Xθ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.17994em"><span class="overlay" style="height:0.714em;width:0.471em"><svg width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>This is simple to implement in Python as a one-liner:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gradient_descent_step</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> theta <span class="token operator">-</span> <span class="token punctuation">(</span>alpha<span class="token operator">/</span>m<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>hypothesis<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">-</span> y<span class="token punctuation">)</span>
</code></pre><p>With all the necessary functions implemented, it&#x27;s time to actually learn the parameters <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span>.</p><h2>Run the Learning Algorithm</h2><p>To run the learning algorithm, let&#x27;s create a loop in which <code>gradient_descent_step</code> is run every iteration:</p><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1630000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    theta <span class="token operator">=</span> gradient_descent_step<span class="token punctuation">(</span>theta<span class="token punctuation">)</span>
</code></pre><p>I found experimentally that after 1.63 million iterations, the cost delta after each iteration of Gradient Descent is negligible.</p><p>After the loop was run, the cost was approximately <code>0.45085533814736584</code>.</p><p>Before we do anything else, let&#x27;s save the optimal <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span> in a file:</p><pre class="language-python"><code class="language-python">np<span class="token punctuation">.</span>savetxt<span class="token punctuation">(</span><span class="token string">&quot;theta.txt&quot;</span><span class="token punctuation">,</span> theta<span class="token punctuation">)</span>
</code></pre><p>Once saved, it can be loaded back like this:</p><pre class="language-python"><code class="language-python">theta <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">&quot;theta.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
theta <span class="token operator">=</span> theta<span class="token punctuation">.</span>T
</code></pre><h2>Run the Model on Test Data</h2><h3>Create the Prediction Function</h3><p>Using the <code>hypothesis(x)</code> function, let&#x27;s define a function that outputs <code>1</code> if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>≥</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">P(y=1|x;\theta) ≥ 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1∣</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0.5</span></span></span></span></span> or <code>0</code> otherwise:</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    h <span class="token operator">=</span> hypothesis<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    comp <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;=</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> comp<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre><p><code>predict(x)</code> runs predictions on a matrix element-wise and converts them into numerical binary values.</p><h3>Import the Test Data</h3><p>Now, it&#x27;s time to bring in the test data, preparing it like we did for the training data:</p><pre class="language-python"><code class="language-python">test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../data/test.csv&quot;</span><span class="token punctuation">)</span>
test_df <span class="token operator">=</span> test_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;Name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;PassengerId&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Ticket&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Cabin&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Pclass <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Pclass<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>normalize_ticket_class<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Sex <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Sex<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>sex_to_numerical<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Fare <span class="token operator">=</span> normalize_fare<span class="token punctuation">(</span>test_df<span class="token punctuation">.</span>Fare<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Embarked <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Embarked<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>embarkation_to_numerical<span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>Age <span class="token operator">=</span> test_df<span class="token punctuation">.</span>Age<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>de_nan_age<span class="token punctuation">)</span>
</code></pre><p>Let&#x27;s add in the <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> column like before:</p><pre class="language-python"><code class="language-python">test_X <span class="token operator">=</span> test_df<span class="token punctuation">.</span>values
x_zero_column_test <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>test_df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x_zero_column_test<span class="token punctuation">,</span> test_X<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>asmatrix<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
</code></pre><h3>Generate Predictions</h3><p>Using the <code>test_X</code> matrix, let&#x27;s generate predictions and save them to a file:</p><pre class="language-python"><code class="language-python">predictions <span class="token operator">=</span> predict<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>savetxt<span class="token punctuation">(</span><span class="token string">&quot;predictions.txt&quot;</span><span class="token punctuation">,</span> predictions<span class="token punctuation">)</span>
</code></pre><h3>Prepare Submission For Kaggle</h3><p>The <code>predictions.txt</code> file isn&#x27;t in the format that Kaggle needs for submission. Let&#x27;s put our predictions into a pandas <code>DataFrame</code> along with the <code>PassengerId</code> column:</p><pre class="language-python"><code class="language-python"><span class="token comment"># Function to flatten nested lists</span>
flatten <span class="token operator">=</span> <span class="token keyword">lambda</span> l<span class="token punctuation">:</span> <span class="token punctuation">[</span>item <span class="token keyword">for</span> sublist <span class="token keyword">in</span> l <span class="token keyword">for</span> item <span class="token keyword">in</span> sublist<span class="token punctuation">]</span>
<span class="token comment"># Temp DataFrame to get PassengerIds</span>
temp_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../data/test.csv&quot;</span><span class="token punctuation">)</span>
submission_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
submission_df<span class="token punctuation">[</span><span class="token string">&quot;PassengerId&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp_df<span class="token punctuation">[</span><span class="token string">&quot;PassengerId&quot;</span><span class="token punctuation">]</span>
submission_df<span class="token punctuation">[</span><span class="token string">&quot;Survived&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>flatten<span class="token punctuation">(</span>predictions<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>Let&#x27;s export to CSV for upload to Kaggle:</p><pre class="language-python"><code class="language-python">submission_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&quot;kaggle_submission.csv&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre><h2>Results</h2><p>According to Kaggle&#x27;s online judge, my model had an accuracy of 74.641% on the test dataset, which is not great by machine learning standards, but was nevertheless exciting for me, since I implemented the model (almost) from scratch.</p><p>This was an improvement over my submission from last year, which was a linear regression algorithm using <code>scikit-learn</code>.</p><p><img src="/static/img/kaggle-score-logistic.png" alt="Kaggle leaderboard screenshot"/>
<em><strong>Figure 2:</strong> Pics or it didn&#x27;t happen</em></p><h2>Conclusion</h2><p>This project was also a chance to dip my toes into creating Machine Learning models for use on real data, taking the theory and applying it to a real-world problem.</p><p>Based on my results, I can also conclude that feature engineering (such as using polynomial features) may be needed to achieve a higher accuracy. Additionally, using something like neural networks may be a better option to achieve higher accuracy, due to their ability to learn complex nonlinear hypotheses.</p><p>If you are a machine learning expert and have suggestions on how I could improve the accuracy of my toy model, I would love to hear them! Comment on the Hacker News thread linked below or email me at the address below.</p><p><a href="https://news.ycombinator.com/item?id=17692378">Discuss on Hacker News</a></p></article></main><div class="mt-32 mb-8 opacity-80"><p class="mt-4 text-xs">© 2020-present Aditya Rathod. All rights reserved.</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/predicting-titanic-survivors","query":{},"buildId":"SX9HTeGJ7ysRzwRU7Wste","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-2a5a419014a6f9bc39d0.js" async=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" async=""></script><script src="/_next/static/chunks/main-05874ade60c38bd3a774.js" async=""></script><script src="/_next/static/chunks/pages/_app-5d52e45cbe5a5e1337a9.js" async=""></script><script src="/_next/static/chunks/pages/blog/predicting-titanic-survivors-261966f5d9712bc6903c.js" async=""></script><script src="/_next/static/SX9HTeGJ7ysRzwRU7Wste/_buildManifest.js" async=""></script><script src="/_next/static/SX9HTeGJ7ysRzwRU7Wste/_ssgManifest.js" async=""></script></body></html>