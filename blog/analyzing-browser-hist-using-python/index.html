<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta property="og:title" content="Analyzing Browser History Using Python and Pandas"/><meta property="og:description" content="Explore the depths of your browser history with this introductory data science tutorial."/><meta property="og:type" content="article"/><meta name="description" content="Explore the depths of your browser history with this introductory data science tutorial."/><title>Analyzing Browser History Using Python and Pandas</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/a32ffd38482d2ae5657c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a32ffd38482d2ae5657c.css"/><link rel="preload" href="/_next/static/kDp1Lwb8riSKqBv1xx0YM/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/kDp1Lwb8riSKqBv1xx0YM/pages/blog/analyzing-browser-hist-using-python.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ca3e7fa29692f350ed1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/f7dc93dbe9e828ad409630ce4361970cb5c8c018.803f13d53fcc71fd0a07.js" as="script"/><link rel="preload" href="/_next/static/chunks/1a81b4811a9afb6801fd647cbfbc7dc633d3bb97.ec503d89e80e050bcc1d.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-ef776554a889c25f7403.js" as="script"/></head><body><div id="__next"><div class="my-8 mx-auto w-full"><button class="absolute text-sm font-bold outline-none text-systemBlue-dark" style="top:10px;right:10px;outline:none">dark<!-- --> mode</button><div class="mb-8"><h1 class="text-3xl text-center font-bold text-label-dark">Aditya Rathod</h1><div class="px-4 max-w-lg mx-auto my-0 flex flex-row items-center justify-between"><a href="/" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">home</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="//github.com/adityarathod" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">github</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="//linkedin.com/in/aditya-rathod" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">linkedin</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="/resume.pdf" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">resumé</a><div class="text-4xl font-thin text-systemGray2-dark select-none">/</div><a href="/blog" class="cursor-pointer px-4 hover:text-link-dark text-label-dark">blog</a></div></div></div><main class="mx-auto my-0 mt-4 max-w-5xl px-8 py-6" style="border-radius:15px"><h1 class="text-label-dark text-4xl font-bold mx-auto my-0 max-w-xl mb-6 text-center">Analyzing Browser History Using Python and Pandas</h1><div class="mb-6 text-center text-secondaryLabel-dark">November 12, 2017</div><p class="my-4 leading-relaxed text-label-dark">Today, we&#x27;re going to do some splunking within the deep, dark place which is your browser history.
In order to obtain the data for this tutorial from Google Chrome, go to
<code>~/Library/Application Support/Google/Chrome/Default</code>
on a Mac/Linux computer or <code>%LocalAppData%\Google\Chrome\User Data\Default</code> on a Windows PC.
Run the following SQLite command to obtain a text file in reverse chronological order:</p><p class="my-4 leading-relaxed text-label-dark">(Mac/Linux)</p><pre class="language-bash"><code class="language-bash">sqlite3 History <span class="token string">&quot;select datetime(last_visit_time/1000000-11644473600,&#x27;unixepoch&#x27;), url \
from urls order by last_visit_time desc&quot;</span> <span class="token operator">&gt;</span> ~/hist.txt
</code></pre><p class="my-4 leading-relaxed text-label-dark">(Windows)</p><pre class="language-bash"><code class="language-bash">sqlite3 History <span class="token string">&quot;select datetime(last_visit_time/1000000-11644473600,&#x27;unixepoch&#x27;), url \
from urls order by last_visit_time desc&quot;</span> <span class="token operator">&gt;</span> %userprofile%<span class="token punctuation">\</span>hist.txt
</code></pre><p class="my-4 leading-relaxed text-label-dark">Check your user folder. A file called <code>hist.txt</code> should be there. Move the file to a suitable place for this exercise.</p><p class="my-4 leading-relaxed text-label-dark">(This process brought to you by the brilliant people at <a href="https://superuser.com/questions/602252/can-chrome-browser-history-be-exported-to-an-html-file" class="text-link-dark">https://superuser.com/questions/602252/can-chrome-browser-history-be-exported-to-an-html-file</a>)</p><p class="my-4 leading-relaxed text-label-dark">Import the needed libraries, <code>numpy</code> and <code>pandas</code>:</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
</code></pre><h1 class="text-2xl font-bold mt-4 text-label-dark">Clean Up Data</h1><p class="my-4 leading-relaxed text-label-dark">That data that we pulled is extremely messy. Here&#x27;s an example row:</p><pre class="language-wiki"><code class="language-wiki">2017-11-12 21:10:11|https://news.ycombinator.com/item?id=15678587
</code></pre><p class="my-4 leading-relaxed text-label-dark">We need to split on that vertical bar while making sure not to split on a bar in the URL itself.
Since Pandas probably doesn&#x27;t do this out of the box, let&#x27;s write a custom import function:</p><pre class="language-python"><code class="language-python"><span class="token comment"># Open our file</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#x27;hist.txt&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    content <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Strip whitespace then split on first occurrence of pipe character</span>
raw_data <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#x27;|&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token punctuation">[</span>x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> content<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment"># We now have a 2D list.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>raw_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><pre class="language-wiki"><code class="language-wiki"><span class="token url">[&#x27;2017-11-12 21:09:21&#x27;, &#x27;https://news.ycombinator.com/&#x27;]</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Using our 2D list, let&#x27;s make a Pandas DataFrame with custom column headers.</p><pre class="language-python"><code class="language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>raw_data<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#x27;datetime&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;url&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Make sure it is working:</p><pre class="language-python"><code class="language-python">data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><table class="table-auto my-6 mx-auto text-label-dark"><thead><tr><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark"> </th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">datetime</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">url</th></tr></thead><tbody><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">2017-11-12 21:10:11</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark"><a href="https://news.ycombinator.com/item?id=15678587" class="text-link-dark">https://news.ycombinator.com/item?id=15678587</a></td></tr></tbody></table><p class="my-4 leading-relaxed text-label-dark">Now, we&#x27;re almost done with ingesting the data. Let&#x27;s convert the
datetime string column into a column of Pandas <code>datetime</code> elements.</p><pre class="language-python"><code class="language-python">data<span class="token punctuation">.</span>datetime <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>data<span class="token punctuation">.</span>datetime<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Double-check that it is indeed a Pandas timestamp:</p><pre class="language-python"><code class="language-python">data<span class="token punctuation">.</span>datetime<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Finally, let&#x27;s remove all information from the URL, leaving only the domain/subdomain:</p><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
parser <span class="token operator">=</span> <span class="token keyword">lambda</span> u<span class="token punctuation">:</span> urlparse<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span>netloc
data<span class="token punctuation">.</span>url <span class="token operator">=</span> data<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>parser<span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark">Let&#x27;s check our work again:</p><pre class="language-python"><code class="language-python">data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><table class="table-auto my-6 mx-auto text-label-dark"><thead><tr><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark"> </th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">datetime</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">url</th></tr></thead><tbody><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">2017-11-12 21:10:11</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">news.ycombinator.com</td></tr></tbody></table><p class="my-4 leading-relaxed text-label-dark">Finally, our data is clean.</p><h1 class="text-2xl font-bold mt-4 text-label-dark">Analyzing the Data</h1><p class="my-4 leading-relaxed text-label-dark">Now that the boring part is done, let&#x27;s analyze our browsing data.</p><h2 class="text-xl font-medium my-2 text-label-dark">Most Visited Sites</h2><p class="my-4 leading-relaxed text-label-dark">Let&#x27;s generate a list of our top sites sorted by frequency, then print out the first two to get our most visited sites:</p><pre class="language-python"><code class="language-python"><span class="token comment"># Aggregate domain entries</span>
site_frequencies <span class="token operator">=</span> data<span class="token punctuation">.</span>url<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Make the domain a column</span>
site_frequencies<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># Rename columns to appropriate names</span>
site_frequencies<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#x27;domain&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;count&#x27;</span><span class="token punctuation">]</span>
<span class="token comment"># Display top 2</span>
site_frequencies<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><table class="table-auto my-6 mx-auto text-label-dark"><thead><tr><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark"> </th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">domain</th><th class="font-bold text-center px-4 py-2 align-middle text-label-dark bg-tertiarySystemFill-dark">count</th></tr></thead><tbody><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">0</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark"><a href="http://www.google.com" class="text-link-dark">www.google.com</a></td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">3904</td></tr><tr><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">github.com</td><td class="px-4 py-2 align-middle text-label-dark bg-quaternarySystemFill-dark">1571</td></tr></tbody></table><p class="my-4 leading-relaxed text-label-dark">It should come as no shock that my top sites, just like any other dev, were Google and Github.</p><p class="my-4 leading-relaxed text-label-dark"><em>(Is secretly surprised that Stack Overflow was not one of the top ten)</em></p><p class="my-4 leading-relaxed text-label-dark">Now, let&#x27;s see our top sites in a beautiful chart:</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
topN <span class="token operator">=</span> <span class="token number">20</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#x27;Top $n Sites Visited&#x27;</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#x27;$n&#x27;</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>topN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pie_data <span class="token operator">=</span> site_frequencies<span class="token punctuation">[</span><span class="token string">&#x27;count&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span>topN<span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
pie_labels <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token comment"># Uncomment to get specific domain names</span>
<span class="token comment"># pie_labels = site_frequencies[&#x27;domain&#x27;].head(topN).tolist()</span>
plt<span class="token punctuation">.</span>pie<span class="token punctuation">(</span>pie_data<span class="token punctuation">,</span> autopct<span class="token operator">=</span><span class="token string">&#x27;%1.1f%%&#x27;</span><span class="token punctuation">,</span> labels<span class="token operator">=</span>pie_labels<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p class="my-4 leading-relaxed text-label-dark"><img src="/static/img/browser-hist-graph.jpg" alt="Pie Chart" class="mx-auto my-4 text-center"/></p><p class="my-4 leading-relaxed text-label-dark">What else can we do with the data? A lot, I&#x27;m sure, since this is the Holy Grail for ad tracking companies.</p></main><div class="mt-32 mb-8 text-center text-secondaryLabel-dark"><p>Designed by Aditya in California.</p><p class="mt-4 text-xs">© 2020 Aditya Rathod. All rights reserved.</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/analyzing-browser-hist-using-python","query":{},"buildId":"kDp1Lwb8riSKqBv1xx0YM","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-1c161e633660818aa2c3.js"></script><script async="" data-next-page="/_app" src="/_next/static/kDp1Lwb8riSKqBv1xx0YM/pages/_app.js"></script><script async="" data-next-page="/blog/analyzing-browser-hist-using-python" src="/_next/static/kDp1Lwb8riSKqBv1xx0YM/pages/blog/analyzing-browser-hist-using-python.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.ca3e7fa29692f350ed1d.js" async=""></script><script src="/_next/static/chunks/f7dc93dbe9e828ad409630ce4361970cb5c8c018.803f13d53fcc71fd0a07.js" async=""></script><script src="/_next/static/chunks/1a81b4811a9afb6801fd647cbfbc7dc633d3bb97.ec503d89e80e050bcc1d.js" async=""></script><script src="/_next/static/runtime/main-ef776554a889c25f7403.js" async=""></script><script src="/_next/static/kDp1Lwb8riSKqBv1xx0YM/_buildManifest.js" async=""></script><script src="/_next/static/kDp1Lwb8riSKqBv1xx0YM/_ssgManifest.js" async=""></script></body></html>